<html>
<body>
<footer>
		<div class="container">
			<div class="row">
				Green Connect Social Website | All Rights Reserved &copy; <%= new Date().getFullYear() %>
			</div>
		</div>
	</footer>
</div>

<div class="modal" id="shareInPagesModal" tabindex="-1" role="dialog" aria-hidden="true">
	<div class="modal-dialog" style="max-width: 1000px;">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Share in pages you manage</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>

			<div class="modal-body"></div>
		</div>
	</div>
</div>

<div class="modal" id="shareInGroupModal" tabindex="-1" role="dialog" aria-hidden="true">
	<div class="modal-dialog" style="max-width: 1000px;">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Share in groups</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>

			<div class="modal-body"></div>
		</div>
	</div>
</div>

<div class="modal" id="replyModal" tabindex="-1" role="dialog" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Reply</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>

			<div class="modal-body">
				<form onsubmit="return doPostReply(this);">
					<input type="hidden" name="postId">
					<input type="hidden" name="commentId">
					<textarea name="reply" placeholder="Post your reply"></textarea>
					<button type="submit">Post</button>
				</form>
			</div>
		</div>
	</div>
</div>

<!-- The Modal -->
<div id="edit-post-modal" class="modal">
	<!-- Modal content -->
	<div class="modal-content">
		<h3>Edit post <span class="close" onclick="closeModal('edit-post-modal')">&times;</span></h3>

		<form method="POST" action="/editPost" id="form-edit-post" onsubmit="return doEditPost(this);">			
			<input type="hidden" name="_id">
			<input type="hidden" name="type">

			<textarea rows="2" name="caption" placeholder="write something"></textarea>
			<div class="attachments">
				<ul>

					<li>
						<img id="edit-post-img-preview" style="display: none; width: 100%; margin-bottom: 10px;">
					</li>

					<li>
						<video id="edit-post-video-preview" controls style="display: none; width: 100%; margin-bottom: 10px;"></video>
					</li>

					<li>
						<i class="fa fa-image"></i>
						<label class="fileContainer">
							<input type="file" name="image" accept="image/*" onchange="previewPostImage(this, 'edit-post-img-preview');">
						</label>
					</li>

					<li>
						<i class="fa fa-video-camera"></i>
						<label class="fileContainer">
							<input type="file" name="video" accept="video/*" onchange="previewPostVideo(this, 'edit-post-video-preview');">
						</label>
					</li>

					<li>
						<button type="submit" name="submit">
							Post
							<i class="fa fa-spinner fa-spin" style="display: none;"></i>
						</button>
					</li>
				</ul>
			</div>
		</form>
	</div>
</div>

<!-- The Modal -->
<div id="delete-post-modal" class="modal">
	<!-- Modal content -->
	<div class="modal-content" style="width: 500px;">
		<h3>Delete <span class="close" onclick="closeModal('delete-post-modal')">&times;</span></h3>
		
		<p>Are you sure you want to delete this post from Social Network ?</p>
		<button type="button" class="btn btn-danger" onclick="deletePost(this);">Delete</button>
	</div>
</div>

<!-- The Modal -->
<div id="post-likers-modal" class="modal">
	<!-- Modal content -->
	<div class="modal-content" style="width: 500px;">
		<!-- created from AJAX -->
	</div>
</div>

<!-- The Modal -->
<div id="post-sharers-modal" class="modal">
	<!-- Modal content -->
	<div class="modal-content" style="width: 500px;">
		<!-- created from AJAX -->
	</div>
</div>

<script src="/public/js/jquery-3.3.1.min.js"></script>
<script src="/public/js/main.min.js"></script>
<script src="/public/swal/sweetalert.min.js"></script>
<script src="/public/js/script.js"></script>
<script src="/public/js/socket.io.js"></script>
<script src="/public/js/load-more.js"></script>

<script src="/public/wysiwyg/js/froala_editor.min.js"></script>
<script src="/public/wysiwyg/js/plugins/image.min.js"></script>
<script src="/public/wysiwyg/js/plugins/video.min.js"></script>

<script>

	window.user = null;
	var socketIO = io(mainURL);

	function getUser() {

		if (localStorage.getItem("accessToken")) {

			var ajax = new XMLHttpRequest();
			ajax.open("POST", "/getUser", true);

			ajax.onreadystatechange = function() {
				if (this.readyState == 4 && this.status == 200) {

					var response = JSON.parse(this.responseText);

					if (response.status == "success") {
						window.user = response.data;

						/* render my public profile link */
						if (document.getElementById("link-my-public-profile") != null) {
							document.getElementById("link-my-public-profile").setAttribute("href", mainURL + "/user/" + window.user.username);
						}

                        var friends = window.user.friends;
                        var unReadInbox = 0;

                        for (var a = 0; a < friends.length; a++) {
                            for (var b = 0; b < friends[a].inbox.length; b++) {
                                if (!friends[a].inbox[b].is_read) {
                                    unReadInbox++;
                                }
                            }
                        }
                        if (unReadInbox > 0) {
                            document.getElementById("inbox-badge").innerHTML = unReadInbox;
                        }

                        if (typeof isProfileViews !== "undefined" && isProfileViews) {
                        	getProfileViews();
                        }

                        if (typeof isUserProfile !== "undefined" && isUserProfile) {
                        	getUserFeed();
                        }

						if (typeof isUpdateProfile !== "undefined" && isUpdateProfile) {
							showProfileData();
						}

						if (typeof isHomePage !== "undefined" && isHomePage) {
							showAddPost();
							showNewsfeed();
						}

						if (typeof isSearchResults !== "undefined" && isSearchResults) {
							showSearchResults();
						}

						if (typeof isFriends !== "undefined" && isFriends) {
							showFriends();
						}

						if (typeof isPages !== "undefined" && isPages) {
							getPages();
						}

						if (typeof isPageDetail !== "undefined" && isPageDetail) {
							getPageDetail();
						}

						if (typeof isPostDetail !== "undefined" && isPostDetail) {
							showPostDetails();
						}

						if (typeof isRightSidebar !== "undefined" && isRightSidebar) {
							getMyPages();
						}

						if (typeof isGroups !== "undefined" && isGroups) {
							getGroups();
						}

						if (typeof isGroupDetail !== "undefined" && isGroupDetail) {
							getGroupDetail();
						}

						if (typeof isCustomerSupport !== "undefined" && isCustomerSupport) {
							getMyAllTickets();
						}

						if (typeof isEditTicketPage !== "undefined" && isEditTicketPage) {
							getTicketData();
						}

						if (typeof isTicketDetail !== "undefined" && isTicketDetail) {
							getTicketDetail();
						}

						if (typeof isNotifications !== "undefined" && isNotifications) {
							showNotifications();
							markNotificationsAsRead();
						} else {
							var notificationsCount = 0;
							for (var a = 0; a < window.user.notifications.length; a++) {
								if (!window.user.notifications[a].isRead) {
									notificationsCount++;
								}
							}
							if (notificationsCount > 0) {
								if (document.getElementById("notifications-badge") != null) {
									document.getElementById("notifications-badge").innerHTML = "(" + notificationsCount + ")";
								}
							}
						}

						var html = `<li>
							<i class="ti-help"></i>
							<a href="/customer-support">Customer support</a>
						</li>`;
						if (document.getElementById("left-sidebar") != null) {
							document.getElementById("left-sidebar").innerHTML += html;
						}

					} else {
						localStorage.removeItem("accessToken");
					}
					showMainMenu();
				}
			};

			var formData = new FormData();
			formData.append("accessToken", localStorage.getItem("accessToken"));
			ajax.send(formData);
		} else {
			showMainMenu();
		}
	}

	function showMainMenu() {
		var html = "";

		if (localStorage.getItem("accessToken")) {

			html += '<li>';
				html += '<a href="/friends">Friends <i class="fa fa-angle-right"></i></a>';
			html += '</li>';

			html += '<li>';
				html += '<a href="/pages">Pages <i class="fa fa-angle-right"></i></a>';
			html += '</li>';

			html += '<li>';
				html += '<a href="/groups">Groups <i class="fa fa-angle-right"></i></a>';
			html += '</li>';

			html += '<li>';
				html += '<a href="/updateProfile">Profile (' + (window.user == null ? '' : window.user.name) + ') <i class="fa fa-angle-right"></i></a>';
			html += '</li>';

			html += '<li>';
				html += '<a href="/logout" onclick="return doLogout();">Logout</a>';
			html += '</li>';
		} else {
			html += '<li>';
				html += '<a href="/login">Login <i class="fa fa-angle-right"></i></a>';
			html += '</li>';

			html += '<li>';
				html += '<a href="/signup">Signup <i class="fa fa-angle-right"></i></a>';
			html += '</li>';
		}

		document.getElementById("main-menu").innerHTML = html;
		document.getElementById("main-menu-mobile").innerHTML = html;
	}

	function doLogout() {
		localStorage.removeItem("accessToken");
		return true;
	}

	window.onload = function () {
		getUser();
	};

	/*window.onerror = function (file, line, error) {
		alert(file + " " + line + " " + error);
	};*/
</script>

</body>

</html>